{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Apollo/Desktop/Ride-web/rideshare-frontend/src/components/Map.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\nimport 'leaflet/dist/leaflet.css';\nimport L from 'leaflet';\nimport 'leaflet-routing-machine';\nimport 'leaflet-routing-machine/dist/leaflet-routing-machine.css';\n\n// Extend the L namespace with routing types\ndeclare global {\n  namespace L {\n    namespace Routing {\n      interface RoutingControl extends L.Control {\n        getPlan(): RoutingPlan;\n        getRouter(): any;\n        route(): void;\n        setRouter(router: any): void;\n        on(event: string, callback: (e: any) => void): void;\n        remove(): void;\n      }\n\n      interface RoutingControlOptions {\n        waypoints: L.LatLng[];\n        routeWhileDragging?: boolean;\n        showAlternatives?: boolean;\n        addWaypoints?: boolean;\n        draggableWaypoints?: boolean;\n        fitSelectedRoutes?: boolean;\n        lineOptions?: {\n          styles: {\n            color: string;\n            opacity: number;\n            weight: number;\n          }[];\n        };\n        createMarker?(i: number, waypoint: any, n: number): L.Marker;\n        show?: boolean;\n        router?: any;\n      }\n\n      interface RoutingPlan extends L.Evented {\n        setWaypoints(waypoints: L.LatLng[]): RoutingPlan;\n      }\n    }\n\n    function routing(options: Routing.RoutingControlOptions): Routing.RoutingControl;\n  }\n}\n\n// Fix for default markers\nconst DefaultIcon = L.Icon.Default;\nL.Icon.Default.imagePath = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/';\n\n// Default coordinates (Moscow center)\nconst DEFAULT_COORDS: [number, number] = [55.7558, 37.6173];\n\ninterface MapProps {\n  departureCoords?: [number, number];\n  destinationCoords?: [number, number];\n  onMapClick?: (coords: [number, number]) => void;\n  onMarkerDrag?: (coords: [number, number]) => void;\n  interactive?: boolean;\n}\n\nconst Map = ({ \n  departureCoords = DEFAULT_COORDS, \n  destinationCoords = DEFAULT_COORDS, \n  onMapClick, \n  onMarkerDrag, \n  interactive = true \n}: MapProps) => {\n  const mapRef = useRef<L.Map | null>(null);\n  const routingControlRef = useRef<any>(null);\n  const mapContainerRef = useRef<HTMLDivElement>(null);\n  const mapId = useRef(`map-${Math.random().toString(36).substr(2, 9)}`);\n\n  useEffect(() => {\n    // Validate coordinates\n    const validDeparture = Array.isArray(departureCoords) && departureCoords.length === 2 &&\n      !isNaN(departureCoords[0]) && !isNaN(departureCoords[1]);\n    const validDestination = Array.isArray(destinationCoords) && destinationCoords.length === 2 &&\n      !isNaN(destinationCoords[0]) && !isNaN(destinationCoords[1]);\n\n    if (!validDeparture || !validDestination) {\n      console.error('Invalid coordinates provided:', { departureCoords, destinationCoords });\n      return;\n    }\n\n    // Define marker icons\n    const blueIcon = new L.Icon({\n      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n      iconSize: [25, 41],\n      iconAnchor: [12, 41],\n      popupAnchor: [1, -34],\n      shadowSize: [41, 41]\n    });\n\n    const redIcon = new L.Icon({\n      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n      iconSize: [25, 41],\n      iconAnchor: [12, 41],\n      popupAnchor: [1, -34],\n      shadowSize: [41, 41]\n    });\n\n    // Clean up existing map and routing control\n    const cleanup = () => {\n      if (routingControlRef.current) {\n        routingControlRef.current.remove();\n        routingControlRef.current = null;\n      }\n      if (mapRef.current) {\n        mapRef.current.remove();\n        mapRef.current = null;\n      }\n    };\n\n    // Clean up before initializing new map\n    cleanup();\n\n    // Initialize map\n    mapRef.current = L.map(mapId.current, {\n      center: departureCoords,\n      zoom: 13,\n      layers: [\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          attribution: '© OpenStreetMap contributors'\n        })\n      ]\n    });\n\n    // Add markers\n    const departureMarker = L.marker([departureCoords[0], departureCoords[1]], { icon: blueIcon })\n      .bindPopup('Отправление')\n      .addTo(mapRef.current);\n\n    const destinationMarker = L.marker([destinationCoords[0], destinationCoords[1]], { icon: redIcon })\n      .bindPopup('Прибытие')\n      .addTo(mapRef.current);\n\n    // Create custom router\n    const customRouter = L.Routing.OSRMv1.extend({\n      options: {\n        serviceUrl: 'https://router.project-osrm.org/route/v1'\n      },\n      _route: function(waypoints: L.Routing.Waypoint[], callback: Function, context: any, options: any) {\n        const url = this.options.serviceUrl;\n        const coordinates = waypoints.map(w => `${w.latLng.lng},${w.latLng.lat}`).join(';');\n        \n        fetch(`${url}/driving/${coordinates}?overview=false&alternatives=true&steps=true`, {\n          method: 'GET',\n          headers: {\n            'Accept': 'application/json'\n          }\n        })\n        .then(response => response.json())\n        .then(data => {\n          if (data.error) {\n            callback.call(context, data.error);\n            return;\n          }\n\n          const route = {\n            name: '',\n            coordinates: data.routes[0].geometry.coordinates.map((coord: number[]) => [coord[1], coord[0]]),\n            summary: {\n              totalDistance: data.routes[0].distance,\n              totalTime: data.routes[0].duration\n            },\n            instructions: data.routes[0].legs[0].steps.map((step: any) => ({\n              text: step.maneuver.instruction,\n              distance: step.distance,\n              time: step.duration,\n              type: step.maneuver.type\n            }))\n          };\n\n          callback.call(context, null, [route]);\n        })\n        .catch(error => {\n          console.error('Routing error:', error);\n          callback.call(context, error);\n        });\n      }\n    });\n\n    // Add routing control\n    routingControlRef.current = L.Routing.control({\n      waypoints: [\n        L.latLng(departureCoords[0], departureCoords[1]),\n        L.latLng(destinationCoords[0], destinationCoords[1])\n      ],\n      router: new customRouter(),\n      routeWhileDragging: false,\n      showAlternatives: false,\n      addWaypoints: false,\n      draggableWaypoints: false,\n      fitSelectedRoutes: true,\n      lineOptions: {\n        styles: [\n          { color: '#4F46E5', opacity: 0.8, weight: 6 }\n        ]\n      },\n      createMarker: (i: number, waypoint: any) => {\n        const icon = i === 0 ? blueIcon : redIcon;\n        const marker = L.marker(waypoint.latLng, { icon });\n        marker.bindPopup(i === 0 ? 'Отправление' : 'Прибытие');\n        return marker;\n      },\n      show: true\n    }).addTo(mapRef.current);\n\n    // Fit bounds to show the entire route\n    const bounds = L.latLngBounds([departureCoords, destinationCoords]);\n    mapRef.current.fitBounds(bounds, { padding: [50, 50] });\n\n    // Add click handler if interactive\n    if (interactive && onMapClick) {\n      mapRef.current.on('click', (e: L.LeafletMouseEvent) => {\n        const { lat, lng } = e.latlng;\n        onMapClick([lat, lng]);\n      });\n    }\n\n    // Cleanup function\n    return cleanup;\n  }, [departureCoords, destinationCoords, interactive, onMapClick]);\n\n  return (\n    <div \n      ref={mapContainerRef}\n      id={mapId.current}\n      className=\"w-full h-full rounded-lg shadow-md\" \n      style={{ minHeight: '400px' }} \n    />\n  );\n};\n\nexport default Map; "],"names":[],"mappings":";;;;AAEA;AAEA;AACA;;;AALA;;;;;;AAiDA,0BAA0B;AAC1B,MAAM,cAAc,oJAAA,CAAA,UAAC,CAAC,IAAI,CAAC,OAAO;AAClC,oJAAA,CAAA,UAAC,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG;AAE3B,sCAAsC;AACtC,MAAM,iBAAmC;IAAC;IAAS;CAAQ;AAU3D,MAAM,MAAM,CAAC,EACX,kBAAkB,cAAc,EAChC,oBAAoB,cAAc,EAClC,UAAU,EACV,YAAY,EACZ,cAAc,IAAI,EACT;;IACT,MAAM,SAAS,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAgB;IACpC,MAAM,oBAAoB,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAO;IACtC,MAAM,kBAAkB,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAkB;IAC/C,MAAM,QAAQ,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAE,CAAC,IAAI,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;IAErE,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;yBAAE;YACR,uBAAuB;YACvB,MAAM,iBAAiB,MAAM,OAAO,CAAC,oBAAoB,gBAAgB,MAAM,KAAK,KAClF,CAAC,MAAM,eAAe,CAAC,EAAE,KAAK,CAAC,MAAM,eAAe,CAAC,EAAE;YACzD,MAAM,mBAAmB,MAAM,OAAO,CAAC,sBAAsB,kBAAkB,MAAM,KAAK,KACxF,CAAC,MAAM,iBAAiB,CAAC,EAAE,KAAK,CAAC,MAAM,iBAAiB,CAAC,EAAE;YAE7D,IAAI,CAAC,kBAAkB,CAAC,kBAAkB;gBACxC,QAAQ,KAAK,CAAC,iCAAiC;oBAAE;oBAAiB;gBAAkB;gBACpF;YACF;YAEA,sBAAsB;YACtB,MAAM,WAAW,IAAI,oJAAA,CAAA,UAAC,CAAC,IAAI,CAAC;gBAC1B,SAAS;gBACT,WAAW;gBACX,UAAU;oBAAC;oBAAI;iBAAG;gBAClB,YAAY;oBAAC;oBAAI;iBAAG;gBACpB,aAAa;oBAAC;oBAAG,CAAC;iBAAG;gBACrB,YAAY;oBAAC;oBAAI;iBAAG;YACtB;YAEA,MAAM,UAAU,IAAI,oJAAA,CAAA,UAAC,CAAC,IAAI,CAAC;gBACzB,SAAS;gBACT,WAAW;gBACX,UAAU;oBAAC;oBAAI;iBAAG;gBAClB,YAAY;oBAAC;oBAAI;iBAAG;gBACpB,aAAa;oBAAC;oBAAG,CAAC;iBAAG;gBACrB,YAAY;oBAAC;oBAAI;iBAAG;YACtB;YAEA,4CAA4C;YAC5C,MAAM;yCAAU;oBACd,IAAI,kBAAkB,OAAO,EAAE;wBAC7B,kBAAkB,OAAO,CAAC,MAAM;wBAChC,kBAAkB,OAAO,GAAG;oBAC9B;oBACA,IAAI,OAAO,OAAO,EAAE;wBAClB,OAAO,OAAO,CAAC,MAAM;wBACrB,OAAO,OAAO,GAAG;oBACnB;gBACF;;YAEA,uCAAuC;YACvC;YAEA,iBAAiB;YACjB,OAAO,OAAO,GAAG,oJAAA,CAAA,UAAC,CAAC,GAAG,CAAC,MAAM,OAAO,EAAE;gBACpC,QAAQ;gBACR,MAAM;gBACN,QAAQ;oBACN,oJAAA,CAAA,UAAC,CAAC,SAAS,CAAC,sDAAsD;wBAChE,aAAa;oBACf;iBACD;YACH;YAEA,cAAc;YACd,MAAM,kBAAkB,oJAAA,CAAA,UAAC,CAAC,MAAM,CAAC;gBAAC,eAAe,CAAC,EAAE;gBAAE,eAAe,CAAC,EAAE;aAAC,EAAE;gBAAE,MAAM;YAAS,GACzF,SAAS,CAAC,eACV,KAAK,CAAC,OAAO,OAAO;YAEvB,MAAM,oBAAoB,oJAAA,CAAA,UAAC,CAAC,MAAM,CAAC;gBAAC,iBAAiB,CAAC,EAAE;gBAAE,iBAAiB,CAAC,EAAE;aAAC,EAAE;gBAAE,MAAM;YAAQ,GAC9F,SAAS,CAAC,YACV,KAAK,CAAC,OAAO,OAAO;YAEvB,uBAAuB;YACvB,MAAM,eAAe,oJAAA,CAAA,UAAC,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC;gBAC3C,SAAS;oBACP,YAAY;gBACd;gBACA,MAAM;kDAAE,SAAS,SAA+B,EAAE,QAAkB,EAAE,OAAY,EAAE,OAAY;wBAC9F,MAAM,MAAM,IAAI,CAAC,OAAO,CAAC,UAAU;wBACnC,MAAM,cAAc,UAAU,GAAG;sEAAC,CAAA,IAAK,GAAG,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,MAAM,CAAC,GAAG,EAAE;qEAAE,IAAI,CAAC;wBAE/E,MAAM,GAAG,IAAI,SAAS,EAAE,YAAY,4CAA4C,CAAC,EAAE;4BACjF,QAAQ;4BACR,SAAS;gCACP,UAAU;4BACZ;wBACF,GACC,IAAI;0DAAC,CAAA,WAAY,SAAS,IAAI;yDAC9B,IAAI;0DAAC,CAAA;gCACJ,IAAI,KAAK,KAAK,EAAE;oCACd,SAAS,IAAI,CAAC,SAAS,KAAK,KAAK;oCACjC;gCACF;gCAEA,MAAM,QAAQ;oCACZ,MAAM;oCACN,aAAa,KAAK,MAAM,CAAC,EAAE,CAAC,QAAQ,CAAC,WAAW,CAAC,GAAG;sEAAC,CAAC,QAAoB;gDAAC,KAAK,CAAC,EAAE;gDAAE,KAAK,CAAC,EAAE;6CAAC;;oCAC9F,SAAS;wCACP,eAAe,KAAK,MAAM,CAAC,EAAE,CAAC,QAAQ;wCACtC,WAAW,KAAK,MAAM,CAAC,EAAE,CAAC,QAAQ;oCACpC;oCACA,cAAc,KAAK,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG;sEAAC,CAAC,OAAc,CAAC;gDAC7D,MAAM,KAAK,QAAQ,CAAC,WAAW;gDAC/B,UAAU,KAAK,QAAQ;gDACvB,MAAM,KAAK,QAAQ;gDACnB,MAAM,KAAK,QAAQ,CAAC,IAAI;4CAC1B,CAAC;;gCACH;gCAEA,SAAS,IAAI,CAAC,SAAS,MAAM;oCAAC;iCAAM;4BACtC;yDACC,KAAK;0DAAC,CAAA;gCACL,QAAQ,KAAK,CAAC,kBAAkB;gCAChC,SAAS,IAAI,CAAC,SAAS;4BACzB;;oBACF;;YACF;YAEA,sBAAsB;YACtB,kBAAkB,OAAO,GAAG,oJAAA,CAAA,UAAC,CAAC,OAAO,CAAC,OAAO,CAAC;gBAC5C,WAAW;oBACT,oJAAA,CAAA,UAAC,CAAC,MAAM,CAAC,eAAe,CAAC,EAAE,EAAE,eAAe,CAAC,EAAE;oBAC/C,oJAAA,CAAA,UAAC,CAAC,MAAM,CAAC,iBAAiB,CAAC,EAAE,EAAE,iBAAiB,CAAC,EAAE;iBACpD;gBACD,QAAQ,IAAI;gBACZ,oBAAoB;gBACpB,kBAAkB;gBAClB,cAAc;gBACd,oBAAoB;gBACpB,mBAAmB;gBACnB,aAAa;oBACX,QAAQ;wBACN;4BAAE,OAAO;4BAAW,SAAS;4BAAK,QAAQ;wBAAE;qBAC7C;gBACH;gBACA,YAAY;qCAAE,CAAC,GAAW;wBACxB,MAAM,OAAO,MAAM,IAAI,WAAW;wBAClC,MAAM,SAAS,oJAAA,CAAA,UAAC,CAAC,MAAM,CAAC,SAAS,MAAM,EAAE;4BAAE;wBAAK;wBAChD,OAAO,SAAS,CAAC,MAAM,IAAI,gBAAgB;wBAC3C,OAAO;oBACT;;gBACA,MAAM;YACR,GAAG,KAAK,CAAC,OAAO,OAAO;YAEvB,sCAAsC;YACtC,MAAM,SAAS,oJAAA,CAAA,UAAC,CAAC,YAAY,CAAC;gBAAC;gBAAiB;aAAkB;YAClE,OAAO,OAAO,CAAC,SAAS,CAAC,QAAQ;gBAAE,SAAS;oBAAC;oBAAI;iBAAG;YAAC;YAErD,mCAAmC;YACnC,IAAI,eAAe,YAAY;gBAC7B,OAAO,OAAO,CAAC,EAAE,CAAC;qCAAS,CAAC;wBAC1B,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,MAAM;wBAC7B,WAAW;4BAAC;4BAAK;yBAAI;oBACvB;;YACF;YAEA,mBAAmB;YACnB,OAAO;QACT;wBAAG;QAAC;QAAiB;QAAmB;QAAa;KAAW;IAEhE,qBACE,6LAAC;QACC,KAAK;QACL,IAAI,MAAM,OAAO;QACjB,WAAU;QACV,OAAO;YAAE,WAAW;QAAQ;;;;;;AAGlC;GA9KM;KAAA;uCAgLS","debugId":null}}]
}