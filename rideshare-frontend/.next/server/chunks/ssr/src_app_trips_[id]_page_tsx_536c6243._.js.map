{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Admin/Desktop/sty/diplom3/rideshare-frontend/src/app/trips/%5Bid%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, use } from 'react';\nimport { useRouter } from 'next/navigation';\nimport dynamic from 'next/dynamic';\nimport 'leaflet/dist/leaflet.css';\nimport { format } from 'date-fns';\nimport { ru } from 'date-fns/locale';\nimport { Badge, Card, Avatar, Button } from 'antd';\nimport { UserOutlined } from '@ant-design/icons';\nimport { message } from 'antd';\n\ninterface Trip {\n  id: string;\n  departure_location: string;\n  destination_location: string;\n  departure_coords: string;\n  destination_coords: string;\n  date: string;\n  time: string;\n  price: number;\n  available_seats: number;\n  status: 'draft' | 'active' | 'completed' | 'cancelled';\n  description?: string;\n  route_distance?: string;\n  route_duration?: string;\n  driver: {\n    username: string;\n    first_name?: string;\n    last_name?: string;\n    profile_picture?: string;\n    driver_rating: number;\n  };\n  bookings?: {\n    id: string;\n    status: string;\n    seats_booked: number;\n    passenger: {\n      id: string;\n      username: string;\n    };\n  }[];\n}\n\n// Dynamically import the Map component to avoid SSR issues\nconst MapComponent = dynamic(() => import('@/components/Map'), {\n  ssr: false,\n  loading: () => <div className=\"w-full h-[400px] bg-gray-100 rounded-lg animate-pulse\" />\n});\n\nexport default function TripDetailsPage({ params }: { params: Promise<{ id: string }> }) {\n  const router = useRouter();\n  const [trip, setTrip] = useState<Trip | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [cancelling, setCancelling] = useState(false);\n  const resolvedParams = use(params);\n\n  useEffect(() => {\n    const fetchTripDetails = async () => {\n      try {\n        const token = localStorage.getItem('access_token');\n        if (!token) {\n          router.push('/auth/login');\n          return;\n        }\n\n        const response = await fetch(`http://localhost:8000/api/trips/${resolvedParams.id}/`, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n\n        if (!response.ok) {\n          throw new Error('Failed to fetch trip details');\n        }\n\n        const data = await response.json();\n        setTrip(data);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'An error occurred');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchTripDetails();\n  }, [resolvedParams.id, router]);\n\n  const handleCancelBooking = async () => {\n    try {\n      setCancelling(true);\n      const token = localStorage.getItem('access_token');\n      if (!token) {\n        router.push('/auth/login');\n        return;\n      }\n\n      // Find the user's booking for this trip\n      const userBooking = trip?.bookings?.find(booking => \n        booking.passenger.username === localStorage.getItem('username')\n      );\n\n      if (!userBooking) {\n        throw new Error('Booking not found');\n      }\n\n      const response = await fetch(`http://localhost:8000/api/bookings/${userBooking.id}/cancel/`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to cancel booking');\n      }\n\n      // Refresh trip details\n      const updatedTrip = await fetch(`http://localhost:8000/api/trips/${resolvedParams.id}/`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }).then(res => res.json());\n\n      setTrip(updatedTrip);\n      message.success('Бронирование успешно отменено');\n    } catch (err) {\n      message.error(err instanceof Error ? err.message : 'Ошибка при отмене бронирования');\n    } finally {\n      setCancelling(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center min-h-screen\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex justify-center items-center min-h-screen\">\n        <div className=\"text-red-500\">{error}</div>\n      </div>\n    );\n  }\n\n  if (!trip) {\n    return (\n      <div className=\"flex justify-center items-center min-h-screen\">\n        <div className=\"text-gray-500\">Trip not found</div>\n      </div>\n    );\n  }\n\n  const formattedDate = format(new Date(trip.date), 'd MMMM yyyy', { locale: ru });\n  const statusColor = {\n    draft: 'default',\n    active: 'processing',\n    completed: 'success',\n    cancelled: 'error'\n  }[trip.status];\n\n  const statusLabel = {\n    draft: 'Черновик',\n    active: 'Активная',\n    completed: 'Завершена',\n    cancelled: 'Отменена'\n  }[trip.status];\n\n  const departureCoords = trip.departure_coords?.split(',').map(Number) as [number, number];\n  const destinationCoords = trip.destination_coords?.split(',').map(Number) as [number, number];\n\n  return (\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n      <div className=\"mb-6 flex justify-between items-center\">\n        <h1 className=\"text-2xl font-bold text-gray-900\">Детали поездки</h1>\n        <Badge status={statusColor as any} text={statusLabel} />\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n        <div className=\"space-y-6\">\n          {/* Route Information */}\n          <Card title=\"Маршрут\" className=\"shadow-sm\">\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-2 h-2 rounded-full bg-green-500\" />\n                <span>{trip.departure_location}</span>\n              </div>\n              <div className=\"ml-1 h-4 w-0.5 bg-gray-300\" />\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-2 h-2 rounded-full bg-red-500\" />\n                <span>{trip.destination_location}</span>\n              </div>\n            </div>\n          </Card>\n\n          {/* Driver Information */}\n          <Card title=\"Водитель\" className=\"shadow-sm\">\n            <div className=\"flex items-center space-x-4\">\n              <Avatar\n                size={64}\n                icon={<UserOutlined />}\n                src={trip.driver.profile_picture}\n              />\n              <div>\n                <h3 className=\"text-lg font-medium\">\n                  {trip.driver.first_name && trip.driver.last_name\n                    ? `${trip.driver.first_name} ${trip.driver.last_name}`\n                    : trip.driver.username}\n                </h3>\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"text-yellow-500\">★</span>\n                  <span>{trip.driver.driver_rating.toFixed(1)}</span>\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          {/* Trip Details */}\n          <Card title=\"Детали поездки\" className=\"shadow-sm\">\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-500\">Дата</span>\n                <span>{formattedDate}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-500\">Время</span>\n                <span>{trip.time.slice(0, 5)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-500\">Цена</span>\n                <span className=\"font-medium\">{trip.price} ₽</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-500\">Свободных мест</span>\n                <span>{trip.available_seats}</span>\n              </div>\n              {trip.route_distance && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-500\">Расстояние</span>\n                  <span>{trip.route_distance}</span>\n                </div>\n              )}\n              {trip.route_duration && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-500\">Время в пути</span>\n                  <span>{trip.route_duration}</span>\n                </div>\n              )}\n            </div>\n          </Card>\n\n          {trip.description && (\n            <Card title=\"Описание\" className=\"shadow-sm\">\n              <p className=\"text-gray-700\">{trip.description}</p>\n            </Card>\n          )}\n\n          {/* Booking Information */}\n          {trip.bookings?.some(booking => booking.passenger.username === localStorage.getItem('username')) && (\n            <Card title=\"Ваше бронирование\" className=\"shadow-sm\">\n              <div className=\"space-y-4\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-500\">Статус</span>\n                  <Badge status=\"processing\" text=\"Подтверждено\" />\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-500\">Забронировано мест</span>\n                  <span>{trip.bookings.find(booking => \n                    booking.passenger.username === localStorage.getItem('username')\n                  )?.seats_booked}</span>\n                </div>\n                <Button\n                  type=\"primary\"\n                  danger\n                  onClick={handleCancelBooking}\n                  loading={cancelling}\n                  block\n                >\n                  Отменить бронирование\n                </Button>\n              </div>\n            </Card>\n          )}\n        </div>\n\n        {/* Map */}\n        <div className=\"h-[600px] rounded-lg overflow-hidden shadow-sm\">\n          <MapComponent\n            departureCoords={departureCoords}\n            destinationCoords={destinationCoords}\n            onMapClick={() => {}}\n            onMarkerDrag={() => {}}\n          />\n        </div>\n      </div>\n    </div>\n  );\n} "],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;;AAVA;;;;;;;;;;;AA4CA,2DAA2D;AAC3D,MAAM,eAAe,CAAA,GAAA,+JAAA,CAAA,UAAO,AAAD;;;;;;IACzB,KAAK;IACL,SAAS,kBAAM,8OAAC;YAAI,WAAU;;;;;;;AAGjB,SAAS,gBAAgB,EAAE,MAAM,EAAuC;IACrF,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAe;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,iBAAiB,CAAA,GAAA,qMAAA,CAAA,MAAG,AAAD,EAAE;IAE3B,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,mBAAmB;YACvB,IAAI;gBACF,MAAM,QAAQ,aAAa,OAAO,CAAC;gBACnC,IAAI,CAAC,OAAO;oBACV,OAAO,IAAI,CAAC;oBACZ;gBACF;gBAEA,MAAM,WAAW,MAAM,MAAM,CAAC,gCAAgC,EAAE,eAAe,EAAE,CAAC,CAAC,CAAC,EAAE;oBACpF,SAAS;wBACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;oBACpC;gBACF;gBAEA,IAAI,CAAC,SAAS,EAAE,EAAE;oBAChB,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,QAAQ;YACV,EAAE,OAAO,KAAK;gBACZ,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG;YAChD,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG;QAAC,eAAe,EAAE;QAAE;KAAO;IAE9B,MAAM,sBAAsB;QAC1B,IAAI;YACF,cAAc;YACd,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,IAAI,CAAC,OAAO;gBACV,OAAO,IAAI,CAAC;gBACZ;YACF;YAEA,wCAAwC;YACxC,MAAM,cAAc,MAAM,UAAU,KAAK,CAAA,UACvC,QAAQ,SAAS,CAAC,QAAQ,KAAK,aAAa,OAAO,CAAC;YAGtD,IAAI,CAAC,aAAa;gBAChB,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,WAAW,MAAM,MAAM,CAAC,mCAAmC,EAAE,YAAY,EAAE,CAAC,QAAQ,CAAC,EAAE;gBAC3F,QAAQ;gBACR,SAAS;oBACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;oBAClC,gBAAgB;gBAClB;YACF;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM;YAClB;YAEA,uBAAuB;YACvB,MAAM,cAAc,MAAM,MAAM,CAAC,gCAAgC,EAAE,eAAe,EAAE,CAAC,CAAC,CAAC,EAAE;gBACvF,SAAS;oBACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;gBACpC;YACF,GAAG,IAAI,CAAC,CAAA,MAAO,IAAI,IAAI;YAEvB,QAAQ;YACR,oLAAA,CAAA,UAAO,CAAC,OAAO,CAAC;QAClB,EAAE,OAAO,KAAK;YACZ,oLAAA,CAAA,UAAO,CAAC,KAAK,CAAC,eAAe,QAAQ,IAAI,OAAO,GAAG;QACrD,SAAU;YACR,cAAc;QAChB;IACF;IAEA,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;;;;;;;;;;IAGrB;IAEA,IAAI,OAAO;QACT,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAgB;;;;;;;;;;;IAGrC;IAEA,IAAI,CAAC,MAAM;QACT,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAgB;;;;;;;;;;;IAGrC;IAEA,MAAM,gBAAgB,CAAA,GAAA,qJAAA,CAAA,SAAM,AAAD,EAAE,IAAI,KAAK,KAAK,IAAI,GAAG,eAAe;QAAE,QAAQ,2IAAA,CAAA,KAAE;IAAC;IAC9E,MAAM,cAAc;QAClB,OAAO;QACP,QAAQ;QACR,WAAW;QACX,WAAW;IACb,CAAC,CAAC,KAAK,MAAM,CAAC;IAEd,MAAM,cAAc;QAClB,OAAO;QACP,QAAQ;QACR,WAAW;QACX,WAAW;IACb,CAAC,CAAC,KAAK,MAAM,CAAC;IAEd,MAAM,kBAAkB,KAAK,gBAAgB,EAAE,MAAM,KAAK,IAAI;IAC9D,MAAM,oBAAoB,KAAK,kBAAkB,EAAE,MAAM,KAAK,IAAI;IAElE,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAmC;;;;;;kCACjD,8OAAC,gLAAA,CAAA,QAAK;wBAAC,QAAQ;wBAAoB,MAAM;;;;;;;;;;;;0BAG3C,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CAEb,8OAAC,8KAAA,CAAA,OAAI;gCAAC,OAAM;gCAAU,WAAU;0CAC9B,cAAA,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;;;;;;8DACf,8OAAC;8DAAM,KAAK,kBAAkB;;;;;;;;;;;;sDAEhC,8OAAC;4CAAI,WAAU;;;;;;sDACf,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;;;;;;8DACf,8OAAC;8DAAM,KAAK,oBAAoB;;;;;;;;;;;;;;;;;;;;;;;0CAMtC,8OAAC,8KAAA,CAAA,OAAI;gCAAC,OAAM;gCAAW,WAAU;0CAC/B,cAAA,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,kLAAA,CAAA,SAAM;4CACL,MAAM;4CACN,oBAAM,8OAAC,kNAAA,CAAA,eAAY;;;;;4CACnB,KAAK,KAAK,MAAM,CAAC,eAAe;;;;;;sDAElC,8OAAC;;8DACC,8OAAC;oDAAG,WAAU;8DACX,KAAK,MAAM,CAAC,UAAU,IAAI,KAAK,MAAM,CAAC,SAAS,GAC5C,GAAG,KAAK,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE,KAAK,MAAM,CAAC,SAAS,EAAE,GACpD,KAAK,MAAM,CAAC,QAAQ;;;;;;8DAE1B,8OAAC;oDAAI,WAAU;;sEACb,8OAAC;4DAAK,WAAU;sEAAkB;;;;;;sEAClC,8OAAC;sEAAM,KAAK,MAAM,CAAC,aAAa,CAAC,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0CAOjD,8OAAC,8KAAA,CAAA,OAAI;gCAAC,OAAM;gCAAiB,WAAU;0CACrC,cAAA,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAK,WAAU;8DAAgB;;;;;;8DAChC,8OAAC;8DAAM;;;;;;;;;;;;sDAET,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAK,WAAU;8DAAgB;;;;;;8DAChC,8OAAC;8DAAM,KAAK,IAAI,CAAC,KAAK,CAAC,GAAG;;;;;;;;;;;;sDAE5B,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAK,WAAU;8DAAgB;;;;;;8DAChC,8OAAC;oDAAK,WAAU;;wDAAe,KAAK,KAAK;wDAAC;;;;;;;;;;;;;sDAE5C,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAK,WAAU;8DAAgB;;;;;;8DAChC,8OAAC;8DAAM,KAAK,eAAe;;;;;;;;;;;;wCAE5B,KAAK,cAAc,kBAClB,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAK,WAAU;8DAAgB;;;;;;8DAChC,8OAAC;8DAAM,KAAK,cAAc;;;;;;;;;;;;wCAG7B,KAAK,cAAc,kBAClB,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAK,WAAU;8DAAgB;;;;;;8DAChC,8OAAC;8DAAM,KAAK,cAAc;;;;;;;;;;;;;;;;;;;;;;;4BAMjC,KAAK,WAAW,kBACf,8OAAC,8KAAA,CAAA,OAAI;gCAAC,OAAM;gCAAW,WAAU;0CAC/B,cAAA,8OAAC;oCAAE,WAAU;8CAAiB,KAAK,WAAW;;;;;;;;;;;4BAKjD,KAAK,QAAQ,EAAE,KAAK,CAAA,UAAW,QAAQ,SAAS,CAAC,QAAQ,KAAK,aAAa,OAAO,CAAC,8BAClF,8OAAC,8KAAA,CAAA,OAAI;gCAAC,OAAM;gCAAoB,WAAU;0CACxC,cAAA,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAK,WAAU;8DAAgB;;;;;;8DAChC,8OAAC,gLAAA,CAAA,QAAK;oDAAC,QAAO;oDAAa,MAAK;;;;;;;;;;;;sDAElC,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAK,WAAU;8DAAgB;;;;;;8DAChC,8OAAC;8DAAM,KAAK,QAAQ,CAAC,IAAI,CAAC,CAAA,UACxB,QAAQ,SAAS,CAAC,QAAQ,KAAK,aAAa,OAAO,CAAC,cACnD;;;;;;;;;;;;sDAEL,8OAAC,kMAAA,CAAA,SAAM;4CACL,MAAK;4CACL,MAAM;4CACN,SAAS;4CACT,SAAS;4CACT,KAAK;sDACN;;;;;;;;;;;;;;;;;;;;;;;kCAST,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BACC,iBAAiB;4BACjB,mBAAmB;4BACnB,YAAY,KAAO;4BACnB,cAAc,KAAO;;;;;;;;;;;;;;;;;;;;;;;AAMjC","debugId":null}}]
}